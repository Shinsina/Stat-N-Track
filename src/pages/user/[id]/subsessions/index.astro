---
import { connectToDatabase } from "$lib/mongodb";
import type { Subsession } from "$lib/types";
import SubsessionsLayout from "$lib/layouts/subsessions.astro";
import userIds from "$lib/utils/user-ids";
export function getStaticPaths() {
  return userIds.map((id) => ({ params: { id } }));
}
const { id } = Astro.params;
const seoTitle = `Subsessions - ${id}`;
const seoDescription = `Subsessions page for user ID: ${id}`;
const dbConnection = await connectToDatabase();
const { db } = dbConnection;
const collection = db.collection<Subsession>("subsessions");
const subsessions = await collection
  .find({
    "session_results.2.results": { $elemMatch: { cust_id: Number(id) } },
  })
  .sort({ _id: -1 })
  .toArray();
---

<SubsessionsLayout {id} {seoTitle} {seoDescription} {subsessions} />
